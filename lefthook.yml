# SPDX-FileCopyrightText: 2022 Temple University
#
# SPDX-License-Identifier: GPL-3.0-or-later

# TODO: skip impure attrs - https://github.com/divnix/std/blob/12b3d2bcf7313e9ad790d575992fd69be3767a9f/cells/std/nixago/lefthook.nix#L12-L28

commit-msg:
  scripts:
    "commitlint.sh":
      runner: nix develop --command

pre-commit:
  parallel: true
  commands:
    format:
      run: format {staged_files}
    lint-js:
      glob: "*.{js,ts,jsx,tsx}"
      # FIXME: nextjs linter can't handle multiple files unless a separate flag
      # is specified for each file...... so now we lint everything.....
      run: pnpm run lint

pre-push:
  commands:
    build-nextjs-app:
      run: |
        # FIXME: the wp-env instance should not be necessary here, but until
        # there's a live environment, there's no other graphql endpoint
        pnpm run start:wp
        pnpm run build
    validate-licensing:
      run: reuse lint
